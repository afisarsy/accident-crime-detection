var env = require('dotenv').config();
global.env = env.parsed;

let moment = require('moment');

let mqtt = require('../models/mqtt');

function publishNodeData(topic){
    let locations = [
        {lat:-7.327225, lng:112.730765},
        {lat:-7.275620, lng:112.793219},
        {lat:-7.405901, lng:112.616328},
        {lat:-7.306401, lng:112.761537}
    ];
    let device_id = "gps-04";
    let location_index = 3;
    let status = "car crash";

    topic = `${topic}/node/${device_id}`;
    timestamp = moment().format("YYYY-MM-DD HH:mm:ss");
    data = {lat:locations[location_index].lat, lng:locations[location_index].lng, status:status, timestamp: timestamp};
    console.log("Publishing data:", data, " with topic: ", topic);

    let message = JSON.stringify(data);
    mqtt.publish(topic, message, (err, res) => {
		if (err){
			console.error("Publish node data topic %s | %s error: %s\nmessage:\n%s", topic, err.type, err.error, err.message);
		}
        else{
		    console.log("Publish node data succeed topic %s data: %s", topic, message);
        }
	})
}

function main(){
    topic = 'acd'
    publishNodeData(topic);
}

main();